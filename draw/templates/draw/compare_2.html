<html>
<head>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.2.6/quill.min.js"></script>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script SRC="./js/diff_match_patch.html"></script>
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>

  <link href="https://fonts.googleapis.com/css?family=Roboto:100&display=swap" rel="stylesheet">

</head>
<style type="text/css">

    .flex-grid {
      display: flex;
    }
    .col {
      flex: 1;
    }

    .snippet-body {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      height: 22vh;
      width: 100%;
      background-color: #FBFBFB;
    }

    .snippets {
      display: flex;
      height: 22vh;
      width: 90%;
      /* background-color: black; */
      justify-content: flex-start;
      align-items: center;
    }

    .snippet {
      /* display: flex; */
      margin: 0.5em;
      width: 18vh;
      height: 85%;
      background-color: white;
      border-radius: 10px;
      box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
      cursor: pointer;
    }

    .snippet.active {
      box-shadow: 0 0 3pt 2.2pt rgba(173, 216, 230, 0.7);
      /* border: solid red; */
    }

    .snippet.hover {
      box-shadow: 2px 2px 50px rgba(0, 0, 0, 0.2);
    }

    .s-title{
      padding: 3px 5px 1.5px 8px;
      font-family: PT sans;
      font-size: 1.6em;
      position: relative;
      left: -10px;
    }

    .btn-xs {
      background: #979797 !important;
      border: solid #979797 !important;
      padding: .35rem .4rem .45rem .4rem;
      margin-bottom: 0.34rem;
      font-size: 14px;
      line-height: .5;
      border-radius: .8rem;
      width: 3.45rem;
    }

    .btn-xs:focus{
      outline: none !important;
      /* border: none !important; */
      -webkit-box-shadow: none !important;
      box-shadow: none !important;
      pointer-events: none;
    }

    .s-tags{
      display: flex;
      height: 60%;
      justify-content: space-between;
      align-items: flex-start;
      align-content: flex-start;
      flex-wrap: wrap;
      padding: 0px 5px 0px 5px;
    }

    .s-icon {
      float:left;
      position: relative;
      width: 18px;
      height: 18px;
      left: 14.5vh;
      top: 1vh;
    }

    .add-btn{
      width: 100%;
      height: 100%;
    }

    .select-btn {
      height: 100%;
      width: 100%;
    }

    .workspace-window{
      width: 100%;
      height: 5.5vh;
      background-color:  #cfd8dc; /*b6b6b6*/
      font-family: 'Roboto', sans-serif;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.25em;
    }


    /* ////////////////////// */

    .editor-body{
      display: flex;
      flex-direction: row;
      background-color: #6e88c1;
      height: 95vh;
      overflow:hidden;
      justify-content: space-around;
    }

    /* actual toolbar */
    .ql-toolbar{
      width: 100%;
      text-align: center;
      position:absolute;
      top: 27.5vh;
    }

    .hideToolbar {
      display: none;
    }

    .ql-container{
      width: 100%;
      display: block;
      justify-content: space-around !important;
    }


    .ql-container:nth-of-type(2):nth-last-child(3){
      margin-left: 5vh;
      margin-right: 0px;
    }

    .ql-container:nth-of-type(2):nth-last-child(3) ~ .ql-container {
      margin-left: 4vh;
      margin-right: 5vh;
    }

    .ql-container:nth-of-type(2):nth-last-child(5),
    .ql-container:nth-of-type(2):nth-last-child(5) ~ .ql-container {
      margin-left: 3vh;
      margin-right: 3vh;
    }

    .ql-container:nth-of-type(2):nth-last-child(7),
    .ql-container:nth-of-type(2):nth-last-child(7) ~ .ql-container {
      margin-left: 1.4vh;
      margin-right: 1.4vh;
    }

    .editor, .editor2, .editor3, .editor4{
      top: 10vh;
      height: 91vh;
      border-top-left-radius: 18px;
      border-top-right-radius: 18px;
      margin-top: 30px;
      font-size: 17px;
      box-shadow: 1px 1px 15px rgba(0, 0, 0, 0.10);
    }


    .ql-editor, pre.ql-syntax {
      background-color: #FFFFFF;
      border-top-left-radius: 25px;
      border-top-right-radius: 25px;
      margin-right: 10px;
      padding-top: 30px;
      padding-bottom: 100px;
    }

    .ql-snow, .ql-bubble {
      background-color: #FFFFFF;
    }

    .compNEditbtn-row{

    }

}


</style>

<body>
  <div class = "snippet-body">
      <div class = "snippets">

        <div class = "snippet">
          <div class = "s-icon">
            <img src="../../static/icons/ADD-btn.png" class="add-btn">
          </div>
          <div class = "s-title">
            Title 1
          </div>

          <div class = "s-tags">
            <button type="button" class="btn btn-secondary btn-xs">
              hello
            </button>
            <button type="button" class="btn btn-secondary btn-xs">
              tag
            </button>
            <button type="button" class="btn btn-secondary btn-xs"> <!-- onclick="this.blur();" -->
              tag
            </button>
          </div>
        </div>

      </div>
  </div>

  <div class = "workspace-window">
    COMPARE WORKSPACE
  </div>

  <div class="editor-body">

    <div class="editor"></div>

    <div class = "compNEditbtn-row">
      <div class="btn-group btn-group-toggle" data-toggle="buttons">
        <label class="btn btn-secondary">
          <input type="radio" name="options" id="option1" autocomplete="off" value="compare"> Compare
        </label>
        <label class="btn btn-secondary active">
          <input type="radio" name="options" id="option2" autocomplete="off" value="edit" checked> Edit
        </label>
      </div>
    </div>

    <div class="master" style="display:none">
      <div class="btn-group btn-group-toggle" data-toggle="buttons">
        <label class="btn btn-secondary">
          <input type="radio" name="master-child" id="option1" autocomplete="off" value="mc1"> Title 1
        </label>
        <label class="btn btn-secondary active">
          <input type="radio" name="master-child" id="option2" autocomplete="off" value="mc2"> Title 2
        </label>

        <label class="btn btn-secondary active">
          <input type="radio" name="master-child" id="option2" autocomplete="off" value="mc3"> Title 3
        </label>
      </div>
    </div>


    <div class="flex-grid">
      <div id="quill-1" class="editor">


        Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Tellus mauris a diam maecenas sed. Amet nisl suscipit adipiscing bibendum est ultricies integer. Amet cursus sit amet
        dictum. Tempus quam pellentesque nec nam. Iaculis at erat pellentesque adipiscing. Ornare arcu dui vivamus arcu felis bibendum ut tristique et. Tincidunt augue interdum velit euismod in pellentesque. Felis eget velit aliquet sagittis id.
        Velit dignissim sodales ut eu sem integer vitae justo. Elementum curabitur vitae nunc sed velit. Ultrices vitae auctor eu augue ut lectus arcu bibendum. Est sit amet facilisis magna etiam tempor orci. Volutpat commodo sed egestas egestas
        fringilla phasellus faucibus scelerisque eleifend. Est velit egestas dui id. Porttitor leo a diam sollicitudin tempor id. Massa id neque aliquam vestibulum morbi blandit. Semper quis lectus nulla at volutpat. Proin nibh nisl condimentum id.
        Egestas congue quisque egestas diam. Faucibus a pellentesque sit amet porttitor eget. Id nibh tortor id aliquet lectus proin nibh. Sed viverra ipsum nunc aliquet bibendum enim. Sapien faucibus et molestie ac feugiat. Sed tempus urna et
        pharetra pharetra massa massa. Tincidunt tortor aliquam nulla facilisi cras. Consectetur lorem donec massa sapien faucibus et. Euismod nisi porta lorem mollis aliquam. Placerat orci nulla pellentesque dignissim enim sit amet. Rhoncus mattis
        rhoncus urna neque viverra justo nec.


      </div>

      <div id="quill-2" class="editor">
        Egestas congue quisque egestas diam. Faucibus a pellentesque sit amet porttitor eget. Id nibh tortor id aliquet lectus proin nibh. Sed viverra ipsum nunc aliquet bibendum enim. Sapien faucibus et molestie ac feugiat. Sed tempus urna et
        pharetra pharetra massa massa. Tincidunt tortor aliquam nulla facilisi cras. Consectetur lorem donec massa sapien faucibus et. Euismod nisi porta lorem mollis aliquam. Placerat orci nulla pellentesque dignissim enim sit amet. Rhoncus mattis
        rhoncus urna neque viverra justo nec.

        Posuere lorem ipsum dolor sit amet consectetur. Nullam eget felis eget nunc lobortis mattis. Massa sapien faucibus et molestie. Risus in hendrerit gravida rutrum quisque non. Eget felis eget nunc lobortis mattis aliquam faucibus. Odio morbi
        quis commodo odio aenean sed. Aliquam ut porttitor leo a diam. Sed adipiscing diam donec adipiscing tristique risus nec. Interdum velit euismod in pellentesque massa placerat duis ultricies lacus. Cursus risus at ultrices mi tempus imperdiet
        nulla malesuada pellentesque. Eros donec ac odio tempor orci dapibus ultrices in iaculis. Justo donec enim diam vulputate ut. Pellentesque eu tincidunt tortor aliquam nulla facilisi cras.

      </div>

      <div id="quill-3" class="editor">
        asdfasdfasdfasdfasdfasdfasdfasdf
        asdfasdfasdfasdfasdfawskjnrbjanwkrn
        awflawkenfawnefjawkejnfkawjnefkjnawef
        akwjefnakwjenfkajwnefkjanwekfjnawkejfnakwe
      </div>

    </div>
  </div>

</body>

<!-- Include the Quill library -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<!-- Initialize Quill editor -->
<script>

  $(".snippet").hover(function(){
      if ($(this).hasClass('active') != true){
          $(this).addClass('hover');
        }
    }, function(){
      $(this).removeClass('hover');
  });

  $(".snippet").click(function(){
    $(this).removeClass('hover');
    if ($(this).hasClass('active')){
      $(this).removeClass('active');
      $($(this)[0].childNodes[1]).html('<img src="../../static/icons/ADD-btn.png" class = "add-btn">');
      // var index = comparelist.indexOf(snippetclicked);
      // comparelist.splice(index, 1);
    } else {
      // comparelist.push(snippetclicked);
      $($(this)[0].childNodes[1]).html('<img src="../../static/icons/check-circle-solid.svg" class = "select-btn">');
      $(this).addClass('active');
    }
  });





/*------------------------Quil Start------------------------------*/
  var toolbarOptions = [
    [{ 'font': [] }],
    ['bold', 'italic', 'underline', 'strike'],        // toggled buttons
    ['blockquote', 'code-block'],

    [{ 'header': 1 }, { 'header': 2 }],               // custom button values
    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
    [{ 'script': 'sub'}, { 'script': 'super' }],      // superscript/subscript
    [{ 'indent': '-1'}, { 'indent': '+1' }],          // outdent/indent
    [{ 'direction': 'rtl' }],                         // text direction

    [{ 'size': ['small', false, 'large', 'huge'] }],  // custom dropdown
    [{ 'header': [1, 2, 3, 4, 5, 6, false] }],

    [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme
    [{ 'align': [] }],

    ['clean']                                         // remove formatting button
  ];

  var noSelected = 0;


  $($(".ql-toolbar")[1]).addClass('hideToolbar');


  $(".ql-container").hover(function(){

  });


var quill = new Quill('#quill-1', {
  theme: 'snow'
});

var quill2 = new Quill('#quill-2', {
  theme: 'snow'
});

var quill3 = new Quill('#quill-3', {
  theme: 'snow'
});


//dictMe should retrieved from the database
dicMe = {1:quill.getText(),
  2:quill2.getText(),
  3:quill3.getText()}


  indexArray = [quill,quill2,quill3]




  $('input[name=options]').change(function(){
    var value = $( 'input[name=options]:checked' ).val();
    var options = {}
    if (value=='compare'){
      quill.enable(false)
      quill2.enable(false)
      quill3.enable(false)
      $(".master").show();
      dicMe[1] = quill.getText();
      dicMe[2] = quill2.getText()
      dicMe[3] = quill3.getText()
      launch(1)


    }else{

      quill.enable(true)
      quill2.enable(true)
      quill3.enable(true)
      quill.setText(dicMe[1])
      quill2.setText(dicMe[2])
      quill3.setText(dicMe[3])

      $(".master").hide();

    }
  });

  $('input[name=master-child]').change(function(){
    var value = $( 'input[name=master-child]:checked' ).val();

    if (value=='mc1'){
      launch(1);
    }else if (value=='mc2'){
      launch(2);
    } else if(value =='mc3'){
      launch(3);
    }


  });









  diff_match_patch.prototype.diff_to_getDifference = function(diffs,child) {
    results = ""

    var currentQuill = indexArray[child-1]
    idx = 0
    for (var x = 0; x < diffs.length; x++) {
      var op = diffs[x][0];    // Operation (insert, delete, equal)
      var data = diffs[x][1];  // Text of change.

      results += data
      switch (op) {
        case 1:
        currentQuill.insertText(idx, data, {
          'background': '#adff2f'
        });
        break;
        case -1:
        currentQuill.insertText(idx, data, {
          'background': '#f08080'
        });
        break;
        case 0:
        currentQuill.insertText(idx, data, {
          'color': '#000000'
        });
        break;
      }
      idx += data.length
    }


    return results

  }



  var dmp = new diff_match_patch();
  dmp.Diff_Timeout = 1
  dmp.Diff_EditCost = 4

  function launch(master) {

    var masterText = dicMe[master]


    for (let key = 1; key <= 3; key++) {
      if (key == master){
        var masterQuill = indexArray[key-1]
        masterQuill.setText("")
        masterQuill.setText(dicMe[key])
        continue;
      }
      var currentQuill = indexArray[key-1]
      currentQuill.setText("")

      var currentText = dicMe[key]

      // console.log("Look at here" + currentText)
      // console.log("masterText" + masterText)
      // console.log("currentText"+ currentText)
      var d = dmp.diff_main(masterText, currentText);
      dmp.diff_cleanupSemantic(d);
      dmp.diff_to_getDifference(d,key);
    }

  }
</script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

</html>
